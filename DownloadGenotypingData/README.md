# TCGA_PanCancer_Genotyping_Imputation

Last updated: 03/23/2022

## Description
We present a protocol for quality control and assessment of the TCGA Affymetrix Genome-Wide Human SNP Array 6.0 data to generate a high-quality imputed genotyping dataset comprised of ~11M SNPs for more than 9000 patients in the TCGA cohort. The protocol is developed around the structure of TCGA, but it can be adapted to explore other genotyping array data sets.

The code and data deposited here were used to generate the results and resource files for the Sayaman, Saad et al., Immunity 2021 and Carrot-Zhang et al., Cancer Cell 2020 papers.

Code contained herein are meant as a guide and should be modified and adapted to match your server specifications and directories.


## Citations
Please cite Sayaman*, Saad* et al., Immunity 2021 when using the data and code contained here in, and downloading the TCGA QC and HRC imputed genotyping data. 
* Sayaman*, Saad* et al., Immunity (2021). Germline genetic contribution to the immune landscape of cancer. https://doi.org/10.1016/j.immuni.2021.01.011
* Chambwe*, Sayaman*, et al., Analysis of Germline-Driven Ancestry-Associated Gene Expression in Cancers.

Please additionally cite: Carrot-Zhang et al., Cancer Cell 2020 when referencing ancestry assignments and downloading the TCGA QC and HRC imputed genotyping data.
* Carrot-Zhang et al., Cancer Cell (2020). Comprehensive Analysis of Genetic Ancestry and Its Molecular Correlates in Cancer. https://doi.org/10.1016/j.ccell.2020.04.012


## Contents
**Prepare Germline Genetic Variation Dataset**

**Note:** The raw TCGA germline genotyping data is distributed via the controlled access mechanism. Instructions on how to obtain controlled-access datasets are available at: https://gdc.cancer.gov/access-data/obtaining-access-controlled-data. It may take several weeks to obtain TCGA controlled data access so prepare accordingly.

 
## Workflow
**TTiming: Approximately 1-3 weeks. Dependent on server capabilities**

1.	Download Affymetrix Genome Wide SNP 6.0 birdseed genotyping files from normal samples (peripheral blood or normal tissue) and corresponding metadata from the Genomic Data Commons (GDC) TCGA Legacy archive. Select the Files main menu (https://portal.gdc.cancer.gov/legacy-archive).

  a.	Select the Cases tab

   i.	Select ‘TCGA’ for Cancer Program
    
  ii.	Add a Case/Biospecimen Filter, and select ‘samples.sample_type_id’. Enter sample type codes corresponding to normal samples: 10 (Blood Derived Normal),     11 (Solid Tissue Normal), 12 (Buccal Cell Normal), 14 (Bone Marrow Normal) (https://gdc.cancer.gov/resources-tcga-users/tcga-code-tables/sample-type-codes).

  b.	Select the Files tab

   i.	Select ‘Simple nucleotide variation’ from Data Category
    
   ii.	Select ‘Genotypes’ from Data Type
    
   iii.	Select ‘Genotyping array’ from Experimental Strategy
    
   iv.	Select ‘TXT’ from Data Format
    
   v.	Select ‘Affymetrix SNP Array 6.0’ from Platform
    
   vi.	Select ‘controlled’ from Access Level

  c.	Select Add all files to the Cart

**Note:**  Maximum number of items to add to the Cart is 10,000. For files >10,000, use the Case/Biospecimen Filter to download sample types in batches.

  d.	Go to the current Cart, select Metadata and download the metadata JSON file

  e.	From the current Cart, select Download and download the Manifest text file

  f.	Using the Manifest file, download genotyping files using the GDC Data Transfer Tool (https://gdc.cancer.gov/access-data/gdc-data-transfer-tool)

   i.	Follow instructions for downloading the GDC Data Transfer Tool Client

   ii.	Follow instructions from the GDC Data Transfer Tool User’s Guide. See Preparing for Data Download and Upload and Data Transfer Tool Command Line Documentation (https://docs.gdc.cancer.gov/Data_Transfer_Tool/Users_Guide/Getting_Started).

2.	Download the Affymetrix SNP Array 6.0 (release 35) annotation file (http://www.affymetrix.com/support/technical/byproduct.affx?product=genomewidesnp_6).

**Optional:** Alternatively, you can skip this section and request access to the TCGA controlled-access pre-processed and Haplotype Reference Consortium (HRC)-imputed datasets through dbGap (https://www.ncbi.nlm.nih.gov/projects/gap/cgi-bin/study.cgi?study_id=phs000178.v11.p8). Upon approval, you can download the final processed genotyping data (pre- or post-imputation) generated by (Sayaman et al., 2021)  from the GDC publication page associated with (Carrot-Zhang et al., 2020)  (https://gdc.cancer.gov/about-data/publications/CCG-AIM-2020).

3.	From the “Supplemental Data Files” section under “TCGA QC HRC Imputed Genotyping Data” used by the AIM AWG from (Sayaman et al., 2021).

  a.	Download and read the associated metadata file “READ_ME.txt” for a description of the composition of the genotyping files.

  b.	Download the associated “Map_TCGAPatientID_BirdseedFileID.txt” file which describes the file mapping of TCGA Patient IDs to corresponding Birdseed genotyping files.

  c.	Choose the genotyping pre-processing level to download genotyping files for the 10,128 unique individuals that passed the pre-imputation QC protocol:

   i.	Download the “QC Unimputed Genotyping Data” to access the 838,948 autosomal chromosome variants that passed the pre-imputation QC protocol and its associated “READ_ME_1.txt” file.
    
   ii.	Download the “HRC Stranded Genotyping Data” to access the 680,389 correctly matched Haplotype Consortium Reference (HRC) variants that remain after pre-imputation QC, removal of palindromic SNPs and stranding to the HRC (v1.1) panel (McCarthy et al., 2016) and its associated “READ_ME_2.txt” file.

   iii.	Download the “HRC Imputed Genotyping Data” to access the 39,127,678 SNPs imputed to the HRC panel (v1.1) and its associated “READ_ME_4.txt” file.

**Optional:** To impute to the 1000 Genomes Project reference panel (1000G)(1000 Genomes Project Consortium et al., 2015) rather than the HRC panel used in (Carrot-Zhang et al., 2020), download the “1000G Stranded Genotyping Data” to access the 678,304 correctly matched 1000G variants that remain after pre-imputation QC, removal of palindromic SNPs and stranding to the 1000G Phase 3 (version 5) panel and its associated “READ_ME_3.txt” file.

  d.	To download the controlled access data, follow instructions under the “Instructions for Data Download” for “Controlled Access Data”.

   i.	The necessary manifest files are found under the “Data in the GDC” section for “Controlled Access Data”.
